---
title: 运行时数据区概述及线程
date: 2021-03-16
tags: jvm
categories: jvm
---

# 运行时数据区（Runtime Data Area）

## 位置描述

![image-20210316220349337](http://mkstatic.lianbian.net/image-20210316220349337.png)

![image-20210316220425209](http://mkstatic.lianbian.net/image-20210316220425209.png)

## 包含模块

![image-20210316220703086](http://mkstatic.lianbian.net/image-20210316220703086.png)



​	Java虚拟机定义了若干种程序运行期间会使用到的运行时数据区，其中有一些会随着虚拟机启动而创建，随着虚拟机退出而销毁。另外一些则是与线程一一对应的，这些与线程对应的数据区域会随着线程开始和结束而创建和销毁。

![第03章_线程共享和私有的结构](http://mkstatic.lianbian.net/%E7%AC%AC03%E7%AB%A0_%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB%E5%92%8C%E7%A7%81%E6%9C%89%E7%9A%84%E7%BB%93%E6%9E%84.jpg)

上图：灰色的为单独线程私有的，红色的为多个线程共享的。即：

- 每个线程：独立包含程序计数器、栈、本地栈；

- 线程间共享：堆、堆外内存（永久代或元空间、代码缓存）

  

## 关于线程间共享的说明

运行时对象类 Class Runtime

每个JVM只有一个Runtime实例。

即为运行时环境，相当于内存结构的中间的那个框框：运行时环境。

![image-20210316222527180](http://mkstatic.lianbian.net/image-20210316222527180.png)

# 线程

## 概述

1. 线程是一个程序里的运行单元，JVM允许一个应用有多个线程并行的执行；
2. 在Hotspot JVM里，每个线程都与操作系统的本地线程直接映射；
   1. 当一个Java线程准备好执行后，此时一个操作系统的本地线程也同时创建，Java线程执行终止后，本地线程也会回收。
3. 操作系统负责所有线程的安排调度到任何一个可用的CPU上。一旦本地线程初始化成功，它就会调用Java线程中的run()方法；

## JVM系统线程

使用jconsole或者任何一款调试工具，都能看到在后台有许多线程在运行；

这些后台线程不包括调用`public static void main(String[])` 的main线程以及所有这个main线程自己创建的线程；

在Hotspot JVM里主要是以下几个：

1. **虚拟机线程：**这种线程的操作是需要JVM达到<font style="color:red">安全点</font>才回出现。这些操作必须在不同的线程中发生的原因是他们都需要JVM达到安全点，这样堆才不会变化。这种线程的执行包括"stop-the-world"的垃圾手机，线程栈手机，线程挂起以及偏向锁撤销；
2. **周期任务线程：**这种线程是时间周期事件的体现（比如中断），他们一般用于周期性操作的调度执行；
3. **GC线程：**这种线程对在JVM里不同种类的垃圾收集行为提供了支持；
4. **编译线程：**这种线程在运行时会将字节码编译成本地代码；
5. **信号调度线程：**这种线程接收信号并发送给JVM，在它内部通过调用适合的方法进行处理；

